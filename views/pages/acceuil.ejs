<!-- file acceuil.ejs
*   @author   Nathan Levasseur (202339974@edu.clg.qc.ca)
*   @version  1
*   @date     25/09/2025
*   @brief    Page d'accueil du site web
-->

<!DOCTYPE html>
<html lang="fr">
<%- include('../partials/head', { pageTitle: 'Accueil' }) %>

  <body style="font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4;">
    <%- include('../partials/header') %>
      <script src="/socket.io/socket.io.js"></script>
      <script>
        var socket = io(); // Connexion au serveur Socket.io
        socket.on('message', function (message) {
          $('#con').text('Le serveur a un message pour vous : ' + message);
        });
      </script>

      <script>
        $(document).ready(function () {
          var now = new Date();
          var annee = now.getFullYear();
          var mois = now.getMonth() + 1;
          var jour = now.getDate();
          var heure = now.getHours();
          var minute = now.getMinutes();
          var seconde = now.getSeconds();
          var heureClient = annee + '-' + mois + '-' + jour + ' ' + heure + ':' + minute + ':' + seconde;
          $('#heureClient').text('Heure de lancement du client : ' + heureClient);

          function updateTime() {
            now = new Date();
            var timestring = now.toLocaleTimeString();
            $('#heureLive').text('Heure actuelle : ' + timestring);
          }

          $('#poke').click(function () {
            socket.emit('message', $('#alarme').val());
          });

          // Stocke l'heure d'alarme reçue du serveur
          let heureAlarme = null;
          let minAlarme = null;

          socket.on('message', function (message) {
              console.log('Le serveur a un message pour vous : ' + message);

            // Si le message contient "Nouvelle heure d'alarme"
            if (message.startsWith('Nouvelle heure d\'alarme')) {
              // Récupère l'heure et la minute
              let parts = message.split(':');
              heureAlarme = parseInt(parts[1]);
              minAlarme = parseInt(parts[2]);
            }
          });

          function updateTime() {
            let now = new Date();
            let timestring = now.toLocaleTimeString();
            $('#heureLive').text('Heure actuelle : ' + timestring);

            // Vérifie si l'heure actuelle correspond à l'alarme
            if (heureAlarme !== null && minAlarme !== null) {
              if (now.getHours() === heureAlarme && now.getMinutes() === minAlarme) {
                $('#alarr').text('ALARME ! Il est ' + timestring);
              }
            }
          }

          updateTime();

          setInterval(updateTime, 1000); // Met à jour chaque seconde

        });
      </script>

      <script>

      </script>

      <main style="padding: 20px;">
        <h2>Bienvenue sur la page d'accueil</h2>
        <p>Ceci est un exemple de page d'accueil pour un site web utilisant une architecture RESTful avec Express.</p>
      </main>
      <p id="con"></p>
      <p>Heure de lancement du serveur : <%= heuredeLancement %>
      </p>
      <p id="heureClient"></p>
      <p id="heureLive"></p>
      <p id="alarr"></p>
      <form onsubmit="return false;">
        <input type="time" id="alarme" />
        <input type="submit" value="Enregistrer" id="poke" />
      </form>
      <%- include('../partials/footer') %>
  </body>

</html>